#!/bin/bash -e

echo >> /var/log/pluto/umount-wrapper.log || { /bin/mount.wraped "$@" && exit 0; }

. /usr/pluto/bin/LockUtils.sh

echo				   >> /var/log/pluto/umount-wrapper.log
echo "$$ CALLED TO 'umount $@'"    >> /var/log/pluto/umount-wrapper.log
WaitLock "mtab" "mount-wrapper"    >> /var/log/pluto/umount-wrapper.log

/bin/mount.wraped "$@" &
mount_pid=$!

start_date=$(date +%s)
while [[ $(( start_date + 5 )) -ge $(date +%s) ]] && [[ -f /proc/$mount_pid ]]  ;do
	sleep 0.2
done

cat /proc/mounts > /etc/mtab
