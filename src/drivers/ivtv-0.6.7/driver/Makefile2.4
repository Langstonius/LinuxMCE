ifneq ($(KERNELRELEASE),)
M = $(CURDIR)
include $(CURDIR)/Kbuild

export-objs := ivtv-driver.o
list-multi := ivtv.o ivtv-fb.o

ivtv.o: $(ivtv-objs)
	$(LD) $(LDFLAGS) -r -o $@ $(ivtv-objs) 

ivtv-fb.o: $(ivtv-fb-objs)
	$(LD) $(LDFLAGS) -r -o $@ $(ivtv-fb-objs) 

include $(KDIR)/Rules.make
else

MYCPPFLAGS := \
CPPFLAGS="-I../v4l-dvb/linux/include -I../v4l-dvb/v4l -D__KERNEL__ -I$(KDIR)/include"

all::
	$(MAKE) $(MYCPPFLAGS) SUBDIRS=$(CURDIR) \
		-C $(KDIR) modules

install:: all
	$(MAKE) INSTALL_MOD_PATH=$(DESTDIR) SUBDIRS=$(CURDIR) \
		MOD_DESTDIR=$(MDIR) -C $(KDIR) modules_install

clean::
	rm -f *.o .*.o.flags

endif
