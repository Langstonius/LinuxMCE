#!/usr/bin/php -q
<?php
/**
// recordingcheck Copyright (C) Coalescent Systems Inc. (info@coalescentsystems.ca)
// Asterisk Management Portal Copyright (C) 2004 Coalescent Systems Inc. (info@coalescentsystems.ca)
//
//This program is free software; you can redistribute it and/or
//modify it under the terms of the GNU General Public License
//as published by the Free Software Foundation; either version 2
//of the License, or (at your option) any later version.
//
//This program is distributed in the hope that it will be useful,
//but WITHOUT ANY WARRANTY; without even the implied warranty of
//MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
//GNU General Public License for more details.

The program checks the RECORD-IN setting for all members of a Ring Group to determine if the incoming call should be recorded.

*/

define("AGIBIN_DIR", "/var/lib/asterisk/agi-bin");

include(AGIBIN_DIR."/phpagi.php");


/**********************************************************************************************************************/

$agi = new AGI();

$r = $agi->get_variable("ARG3");
if ($r["result"] == 0) {
	$agi->verbose("Extension List not set -- nothing to do");
	exit(1);
}
$extenlist = $r["data"];

$agi->set_variable("RecEnable", "DISABLED"); //disable by default

$list = explode("-",$extenlist);
if(!empty($list)) {
	foreach($list as $exten) {
		$setting = $agi->database_get("RECORD-IN", $exten);
		if ($setting["data"] == "ENABLED") {
			$agi->verbose("Recording enable for ".$exten);
			$agi->set_variable("RecEnable", "ENABLED");
			exit(1);
		}
	}
} else {
	$agi->verbose("Extension List is empty -- nothing to do");
	exit(1);		
}

// we just exit with no changes to the variable.
exit(0);

?>
