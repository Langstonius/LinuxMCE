#!/usr/bin/make -f

DEB_TAR_SRCDIR=hal-0.5.7

include /usr/share/cdbs/1/rules/tarball.mk
include /usr/share/cdbs/1/rules/debhelper.mk
include /usr/share/cdbs/1/class/autotools.mk
include /usr/share/cdbs/1/rules/simple-patchsys.mk
include /usr/share/cdbs/1/rules/utils.mk

DEB_PYTHON_COMPILE_VERSION = 2.4
DEB_CONFIGURE_EXTRA_FLAGS := --with-hal-user=hal  \
                             --with-hal-group=hal \
                             --enable-hotplug-map  \
                             --with-pid-file=/var/run/hal/hald.pid \
                             --enable-pcmcia-support \
                             --with-hwdata=/usr/share/misc

binary-predeb/hal-device-manager::
	dh_python -phal-device-manager

common-install-impl::
	# Don't put links in /etc/dev.d and /etc/hotplug.d
	rm -rf $(DEB_DESTDIR)/etc/hotplug.d
	rm -rf $(DEB_DESTDIR)/etc/dev.d
	rm -rf $(DEB_DESTDIR)/usr/lib/hal/hal.hotplug
	# Remove hal's default udev rules files.. We ship our own
	rm -rf $(DEB_DESTDIR)/etc/udev

	# start/stop hal together with dbus
	install -d $(DEB_DESTDIR)/etc/dbus-1/event.d
	install -m 755 debian/hal.init.dbus \
		$(DEB_DESTDIR)/etc/dbus-1/event.d/20hal
	
	install -m 644 -D debian/hal.udev.rules \
		$(DEB_DESTDIR)/etc/udev/hal.rules
	install -m 755 -D debian/hal-unmount.sh \
		$(DEB_DESTDIR)/usr/lib/hal/hal-unmount.sh

