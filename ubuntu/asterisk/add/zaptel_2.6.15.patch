--- zaptel.c.original	2006-01-23 15:46:53.000000000 +0200
+++ zaptel.c	2006-01-23 15:46:28.000000000 +0200
@@ -157,6 +157,14 @@
 
 /* udev necessary data structures.  Yeah! */
 #ifdef CONFIG_ZAP_UDEV
+#if LINUX_VERSION_CODE >= KERNEL_VERSION(2,6,15)
+#define CLASS_DEV_CREATE(class, devt, device, name) \
+        class_device_create(class, NULL, devt, device, name)
+#else
+#define CLASS_DEV_CREATE(class, devt, device, name) \
+        class_device_create(class, devt, device, name)
+#endif
+
 #if LINUX_VERSION_CODE >= KERNEL_VERSION(2,6,13)
 static struct class *zap_class = NULL;
 #else
@@ -4419,7 +4427,7 @@
 	for (x = 0; x < span->channels; x++) {
 		char chan_name[50];
 		sprintf(chan_name, "zap%d", span->chans[x].channo);
-		class_device_create(zap_class, MKDEV(ZT_MAJOR, span->chans[x].channo), NULL, chan_name);
+		CLASS_DEV_CREATE(zap_class, MKDEV(ZT_MAJOR, span->chans[x].channo), NULL, chan_name);
 	}
 #endif /* CONFIG_ZAP_UDEV */
 
@@ -6514,10 +6522,10 @@
 
 #ifdef CONFIG_ZAP_UDEV /* udev support functions */
 	zap_class = class_create(THIS_MODULE, "zaptel");
-	class_device_create(zap_class, MKDEV(ZT_MAJOR, 253), NULL, "zaptimer");
-	class_device_create(zap_class, MKDEV(ZT_MAJOR, 254), NULL, "zapchannel");
-	class_device_create(zap_class, MKDEV(ZT_MAJOR, 255), NULL, "zappseudo");
-	class_device_create(zap_class, MKDEV(ZT_MAJOR, 0), NULL, "zapctl");
+	CLASS_DEV_CREATE(zap_class, MKDEV(ZT_MAJOR, 253), NULL, "zaptimer");
+	CLASS_DEV_CREATE(zap_class, MKDEV(ZT_MAJOR, 254), NULL, "zapchannel");
+	CLASS_DEV_CREATE(zap_class, MKDEV(ZT_MAJOR, 255), NULL, "zappseudo");
+	CLASS_DEV_CREATE(zap_class, MKDEV(ZT_MAJOR, 0), NULL, "zapctl");
 #endif /* CONFIG_ZAP_UDEV */
 
 #ifdef CONFIG_DEVFS_FS
