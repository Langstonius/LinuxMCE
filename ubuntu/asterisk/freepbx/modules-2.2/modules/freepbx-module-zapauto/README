Zaptel auto detection module for freepbx
----------------------------------------

This module is capable of detecting most Zaptel hardware by a single click
on the WEB interface. The code has a WEB interface, as well as a console only script. 


You need to install sudo on the machine, as have the following lines in /etc/sudoers :

Debian/Ubuntu:
    asterisk ALL=NOPASSWD:/usr/share/freepbx-common/detect_zap

Trixbox/Centos/Fedora:
    asterisk ALL=NOPASSWD:/var/lib/asterisk/bin/detect_zap

These lines are set up by the post install of the RPM/DEB packages,
so usually you don't need to deal with this. In rare cases
in which the lines are missing, please add them manually using the "visudo" 
command.

Note that you also need Zaptel 1.2.8 or above, or Zaptel from Xorcom 
above r1789 (we have this code in also in Zaptel 1.2.6). This is because a special 
version of genzaptelconf is needed on /usr/sbin in order for this hardware detection 
to work. 

Note that the official RPMs for Trixbox/Centos/Fedora do not contain genzaptelconf
and that the version of genzaptelconf found in Trixbox (/usr/local/sbin/genzaptelconf)
is not suitable for this utility.

This version is should work in FreePBX 2.1.X and 2.2.X. If you find a problem, please contact us.

How it works
------------
The hardware detection is splited into 4 logical levels

1) genzaptelconf will generate /etc/zaptel.conf and also make /etc/asterisk/zapata_auto.conf (zapata-channels
   on Trixbox/Centos/Fedora)  with FXO channels only. This stage stops asterisk, generates the FXO definitions 
   as well as the /etc/zaptel.conf needed to properly configure the devices using ztcfg.
   
2) zap2amp will generate the settings for FXS channels (based on what is found on /etc/zapata.conf) from a 
   template (/var/lib/asterisk/bin/zap.template) and upload then into the sql tables, so you can see the FXS
   stations as normal extensions on FreePBX (you can put them into ring groups, have them as the default
   station in incomming calls, etc).

3.a) The retrieve scripts are called. Asterisk configuration are created. 
3.b) Asterisk is restarted with the new Zaptel configuration.

The reason for these stages, is because on zapata HW removal, the configuration will
be so messed up that asterisk will fail to load and freePBX will be completely
non functional. This situation is fixed with Asterisk 1.4 (in which case asterisk will load 
without zap channels).

4) fix_ast_db will connect to the Asterisk manager, and create the apropiate astdb entries for
   dialparties. It will also create the links in the voicemail needed by freePBX to properly work.

If you have any question about the functionality of this package, or bug reports 
please contact support@xorcom.com .
   
- diego

